<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>bundleid</key>
	<string></string>
	<key>category</key>
	<string>Productivity</string>
	<key>connections</key>
	<dict>
		<key>06952588-BB53-4029-B7A2-FECE821900C8</key>
		<array>
			<dict>
				<key>destinationuid</key>
				<string>5C206AA8-A627-43C6-802F-9428A6CDFAE4</string>
				<key>modifiers</key>
				<integer>0</integer>
				<key>modifiersubtext</key>
				<string></string>
				<key>vitoclose</key>
				<false/>
			</dict>
		</array>
		<key>5C206AA8-A627-43C6-802F-9428A6CDFAE4</key>
		<array/>
		<key>F8D64E81-19FF-4044-81F0-BA3E03A131F3</key>
		<array>
			<dict>
				<key>destinationuid</key>
				<string>06952588-BB53-4029-B7A2-FECE821900C8</string>
				<key>modifiers</key>
				<integer>0</integer>
				<key>modifiersubtext</key>
				<string></string>
				<key>vitoclose</key>
				<false/>
			</dict>
		</array>
		<key>7B7C2B0D-9B02-4A1D-AE8F-922E08E9B2A6</key>
		<array>
			<dict>
				<key>destinationuid</key>
				<string>5F64B9E1-9E4A-4E7F-9C9E-7F5C0D1A8B6A</string>
				<key>modifiers</key>
				<integer>0</integer>
				<key>modifiersubtext</key>
				<string></string>
				<key>vitoclose</key>
				<false/>
			</dict>
		</array>
		<key>5F64B9E1-9E4A-4E7F-9C9E-7F5C0D1A8B6A</key>
		<array/>
	</dict>
	<key>createdby</key>
	<string>Mickaël Lherminez</string>
	<key>description</key>
	<string>Corrige, reformule et améliore instantanément le texte sélectionné grâce à des IA modernes (DeepSeek, OpenAI, Anthropic), avec stockage sécurisé des clés API dans le Trousseau macOS.</string>
	<key>disabled</key>
	<false/>
	<key>name</key>
	<string>Syntax Polish</string>
	<key>objects</key>
	<array>
		<dict>
			<key>config</key>
			<dict>
				<key>alfredfiltersresults</key>
				<false/>
				<key>argumenttype</key>
				<integer>2</integer>
				<key>escaping</key>
				<integer>1024</integer>
				<key>keyword</key>
				<string>sp setup</string>
				<key>queuedelaycustom</key>
				<integer>0</integer>
				<key>queuedelayimmediatelyinitially</key>
				<false/>
				<key>queuedelaymode</key>
				<integer>0</integer>
				<key>runningsubtext</key>
				<string>Ouverture de l’assistant de configuration Syntax Polish…</string>
				<key>subtext</key>
				<string>Choisir l’IA (DeepSeek, OpenAI, Anthropic) et enregistrer la clé API dans le Trousseau macOS.</string>
				<key>title</key>
				<string>Syntax Polish — Configurer une clé API</string>
				<key>withspace</key>
				<false/>
			</dict>
			<key>type</key>
			<string>alfred.workflow.input.keyword</string>
			<key>uid</key>
			<string>7B7C2B0D-9B02-4A1D-AE8F-922E08E9B2A6</string>
			<key>version</key>
			<integer>1</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>concurrently</key>
				<false/>
				<key>escaping</key>
				<integer>68</integer>
				<key>script</key>
				<string>#!/usr/bin/env python3
import getpass
import os
import subprocess
import sys


def _run_osascript(script: str) -&gt; str:
    """Exécute un script AppleScript et renvoie stdout (ou chaîne vide en cas d'annulation)."""
    result = subprocess.run(
        ["osascript"],
        input=script,
        text=True,
        capture_output=True,
    )
    if result.returncode != 0:
        return ""
    return result.stdout.strip()


def main() -&gt; int:
    # 1) Demander le provider et la clé API via une seule séquence AppleScript
    applescript = '''
set provider_list to {"deepseek","openai","anthropic"}
set chosen to choose from list provider_list with prompt "Choisis le fournisseur IA à configurer :" default items {"deepseek"}
if chosen is false then
  return ""
end if
set provider to item 1 of chosen
display dialog "Colle ta clé API pour “" &amp; provider &amp; "” :" with title "Syntax Polish" default answer "" with hidden answer buttons {"Annuler","Enregistrer"} default button "Enregistrer"
set api_key to text returned of result
return provider &amp; "::" &amp; api_key
'''

    out = _run_osascript(applescript)
    if not out:
        # Utilisateur a annulé à un moment (liste ou dialog)
        return 0

    if "::" not in out:
        # Format inattendu
        return 1

    provider, api_key = out.split("::", 1)
    provider = provider.strip().lower()
    api_key = api_key.strip()

    if not api_key:
        # Pas de clé saisie
        return 0

    service = f"syntax-polish-{provider}"
    user = getpass.getuser()

    cmd = [
        "security",
        "add-generic-password",
        "-a",
        user,
        "-s",
        service,
        "-w",
        api_key,
        "-U",
    ]

    result = subprocess.run(cmd, capture_output=True, text=True)
    if result.returncode == 0:
        notify_script = f'display notification "Clé enregistrée dans le Trousseau (service : {service})." with title "Syntax Polish"'
        _run_osascript(notify_script)
        return 0

    error_script = (
        f'display dialog "Impossible d’enregistrer la clé dans le Trousseau.\\n\\nService : {service}" '
        'with title "Syntax Polish" buttons {"OK"} default button "OK"'
    )
    _run_osascript(error_script)
    return 1


if __name__ == "__main__":
    raise SystemExit(main())</string>
				<key>scriptargtype</key>
				<integer>0</integer>
				<key>scriptfile</key>
				<string></string>
				<key>type</key>
				<integer>9</integer>
			</dict>
			<key>type</key>
			<string>alfred.workflow.action.script</string>
			<key>uid</key>
			<string>5F64B9E1-9E4A-4E7F-9C9E-7F5C0D1A8B6A</string>
			<key>version</key>
			<integer>2</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>action</key>
				<integer>0</integer>
				<key>argument</key>
				<integer>1</integer>
				<key>focusedappvariable</key>
				<false/>
				<key>focusedappvariablename</key>
				<string></string>
				<key>hotkey</key>
				<integer>41</integer>
				<key>hotmod</key>
				<integer>1048576</integer>
				<key>hotstring</key>
				<string>M</string>
				<key>leftcursor</key>
				<false/>
				<key>modsmode</key>
				<integer>0</integer>
				<key>relatedAppsMode</key>
				<integer>0</integer>
			</dict>
			<key>type</key>
			<string>alfred.workflow.trigger.hotkey</string>
			<key>uid</key>
			<string>F8D64E81-19FF-4044-81F0-BA3E03A131F3</string>
			<key>version</key>
			<integer>2</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>autopaste</key>
				<true/>
				<key>clipboardtext</key>
				<string>{query}</string>
				<key>ignoredynamicplaceholders</key>
				<false/>
				<key>transient</key>
				<false/>
			</dict>
			<key>type</key>
			<string>alfred.workflow.output.clipboard</string>
			<key>uid</key>
			<string>5C206AA8-A627-43C6-802F-9428A6CDFAE4</string>
			<key>version</key>
			<integer>3</integer>
		</dict>
		<dict>
			<key>config</key>
			<dict>
				<key>concurrently</key>
				<false/>
				<key>escaping</key>
				<integer>68</integer>
				<key>script</key>
				<string>#!/usr/bin/env python3
import os
import sys
import subprocess


def _run_workflow() -&gt; int:
    """
    Point d'entrée appelé par Alfred.

    On exécute le vrai script Python du workflow :
    &lt;workflow_dir&gt;/src/python/main.py
    en lui passant les mêmes arguments que ceux reçus par Alfred.
    """
    workflow_dir = os.environ.get("alfred_workflow_directory") or os.getcwd()
    main_path = os.path.join(workflow_dir, "src", "python", "main.py")

    if not os.path.exists(main_path):
        print(f"Erreur : fichier principal introuvable : {main_path}")
        return 1

    result = subprocess.run([sys.executable, main_path, *sys.argv[1:]])
    return result.returncode


if __name__ == "__main__":
    raise SystemExit(_run_workflow())</string>
				<key>scriptargtype</key>
				<integer>1</integer>
				<key>scriptfile</key>
				<string></string>
				<key>type</key>
				<integer>9</integer>
			</dict>
			<key>type</key>
			<string>alfred.workflow.action.script</string>
			<key>uid</key>
			<string>06952588-BB53-4029-B7A2-FECE821900C8</string>
			<key>version</key>
			<integer>2</integer>
		</dict>
	</array>
	<key>readme</key>
	<string>Syntax Polish est un workflow Alfred qui corrige, reformule et améliore ton texte en utilisant des IA modernes (DeepSeek, OpenAI, Anthropic…).

INSTALLATION RAPIDE
- 1) Installe le workflow.
- 2) Dans la barre Alfred, tape : "sp setup".
- 3) Choisis ton fournisseur IA (ex. DeepSeek).
- 4) Colle ta clé API : elle sera stockée chiffrée dans le Trousseau macOS (Keychain).

UTILISATION
- Sélectionne un texte dans n&apos;importe quelle app.
- Appuie sur le raccourci clavier du workflow.
- Le texte corrigé est copié automatiquement dans le presse-papier et collé dans l&apos;app active.

SÉCURITÉ
- Aucune clé API n&apos;est stockée dans Alfred ou dans le repo.
- Les clés sont lues uniquement depuis le Trousseau macOS.
- Aucun tracking, aucun log sensible, aucun stockage de ton texte.

CONFIGURATION AVANCÉE
- Variable Alfred "AI_PROVIDER" pour choisir le provider par défaut (deepseek, openai, anthropic).
- Voir la documentation complète sur GitHub pour les détails et mises à jour.</string>
	<key>uidata</key>
	<dict>
		<key>06952588-BB53-4029-B7A2-FECE821900C8</key>
		<dict>
			<key>colorindex</key>
			<integer>5</integer>
			<key>xpos</key>
			<real>210.0</real>
			<key>ypos</key>
			<real>195.0</real>
		</dict>
		<key>5C206AA8-A627-43C6-802F-9428A6CDFAE4</key>
		<dict>
			<key>colorindex</key>
			<integer>5</integer>
			<key>xpos</key>
			<real>390.0</real>
			<key>ypos</key>
			<real>195.0</real>
		</dict>
		<key>F8D64E81-19FF-4044-81F0-BA3E03A131F3</key>
		<dict>
			<key>colorindex</key>
			<integer>5</integer>
			<key>xpos</key>
			<real>30.0</real>
			<key>ypos</key>
			<real>195.0</real>
		</dict>
		<key>7B7C2B0D-9B02-4A1D-AE8F-922E08E9B2A6</key>
		<dict>
			<key>colorindex</key>
			<integer>2</integer>
			<key>xpos</key>
			<real>30.0</real>
			<key>ypos</key>
			<real>40.0</real>
		</dict>
		<key>5F64B9E1-9E4A-4E7F-9C9E-7F5C0D1A8B6A</key>
		<dict>
			<key>colorindex</key>
			<integer>2</integer>
			<key>xpos</key>
			<real>210.0</real>
			<key>ypos</key>
			<real>40.0</real>
		</dict>
	</dict>
	<key>userconfigurationconfig</key>
	<array/>
	<key>variablesdontexport</key>
	<array/>
	<key>version</key>
	<string>0.11.0</string>
	<key>webaddress</key>
	<string>https://mickaellherminez.net/</string>
</dict>
</plist>
